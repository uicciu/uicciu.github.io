# Algebraic Attack on Convolutional NeuralNetwork with Max Pooling
> (3+1) SIMPLE CNN CRYPTANALYTIC EXTRACTION PROJECT

## Project Overview
This project demonstrates the complete process of successfully recovering the weights of a **three-layer (3+1) CNN** model trained on the MNIST dataset under the black-box scenario.

It is worth noting that, unlike the previous work, the input padding value in the CNN model parameters is set to padding=2 for this implementation.
## Model Architecture
This model is a 3-layer convolutional neural network with three convolution–ReLU–max-pooling blocks followed by two fully connected layers for 10-class classification.

1 × 32 × 32  
→ Conv(1→1, 5×5, pad=2) + ReLU → MaxPool(2×2)  
→ Conv(1→1, 5×5, pad=2) + ReLU → MaxPool(2×2)  
→ Conv(1→1, 5×5, pad=2) + ReLU → MaxPool(2×2)  
→ Flatten (4×4 = 16)  
→ FC1(16→25) + ReLU  
→ FC(25→10)  

## Brief Description of Key Files
1. **extract_signature_cuda.py**: Extracts the signatures of the CNN's three convolutional layers with GPU (CUDA) acceleration. It processes the difference vectors collected from Pooling Switch Points (PSP) via Singular Value Decomposition (SVD), solves homogeneous linear equations, and extracts the weights of the **three convolutional layers**. This file also contains core functions such as pattern matching (```find_pattern_starts & find_diff_pattern```) and max-pooling layer processing (```pool_patch_difference```).
2. **reconstructCNN.py**: Its specific implementation is consistent with the previous version. It is designed to implement core functions including critical point filtering, matrix representation of network architecture, parameter matching and alignment, and error analysis. In addition, it provides intuitive visual processing for scenarios with different input padding values.
3. **AttackCNN_Function.py**:Contains functions for recovering the weights of the first convolutional layer.
4. **AttackCNN2_Function.py**:Contains functions for recovering the weights of the second convolutional layer.
5. **AttackCNN3_Function.py**:Contains functions for recovering the weights of the third convolutional layer.


## Workflow Pipeline

### STEP1:Generate the CNN Model

```bash
python create_CNN.py
```
Of course, the model has already been trained using `create_CNN.py`. We provide the corresponding model (`simple_cnn_3+1_padding2.pth`) in the repository, which is ready for direct use.

### STEP2:Extract CNN Model Weights

#### One-Click Extraction of Weights for Three Convolutional Layers
```bash
python Attack_all.py
```
This script is largely consistent with the weight recovery workflow for the (2+1) CNN model. It serves as the master control program for the entire attack framework and implements a complete, fully automated chained attack pipeline for multi-layer convolutional neural networks.

## Explanation of this Codebase
This codebase bases its structure from Carlini et al's codebase that can be found under https://github.com/google-research/cryptanalytic-model-extraction.All convolutional and max-pooling specific components are implemented independently in this work.

## Installation
```bash
pip install torch numpy scipy jax jaxlib matplotlib networkx
```
---
