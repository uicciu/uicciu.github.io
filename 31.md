# (3+1) SIMPLE CNN CRYPTANALYTIC EXTRACTION PROJECT

## Project Overview
This project demonstrates the complete process of successfully recovering the weights of a **three-layer (3+1)** CNN model trained on MNIST dataset under the **black-box scenario**.

值得注意的是，与之前不同的是，此时CNN模型参数中输入填充值为：padding=2

## Brief Description of Key Files
1. **common.py**:Provides basic configurations and model definitions, and stores model information for accuracy testing.
2. **extract_signature_cuda.py**: Extracts the signatures of the CNN's **three convolutional layers** with GPU(CUDA) acceleration, processes the difference vectors collected from Pooling Switch Points (PSP) via Singular Value Decomposition (SVD), solves homogeneous linear equations, and extracts the weights of the two convolutional layers.包含模式匹配(```find_pattern_starts & find_diff_pattern```),池化层处理(```pool_patch_difference```)等重要函数。
4. **reconstructCNN.py**: 具体实现与之前一致，用于实现关键点过滤，网络结构的矩阵化表达，参数匹配与对齐，误差分析等核心功能,，同时对输入填充不同的情况进行了形象化的处理
5. **AttackCNN_Function.py**:Contains functions for recovering the weights of the first convolutional layer.
6. **AttackCNN2_Function.py**:Contains functions for recovering the weights of the second convolutional layer.
7. **AttackCNN3_Function.py**:Contains functions for recovering the weights of the third convolutional layer.

## Workflow Pipeline

### STEP1:Generate the CNN Model

```bash
python create_CNN.py
```
Modify the parameters to generate your own CNN model, or directly use the pre-generated model we provide (e.g., simple_cnn_3+1_padding2.pth).

Meanwhile, import your newly generated model into **common.py**.

### STEP2:Extract CNN Model Weights

#### One-Click Extraction of Weights for Three Convolutional Layers
```bash
python Attack_all.py
```
与(2+1)CNN模型的权重恢复工作基本一致，是整个攻击框架的总控制程序，实现了一套完整的、针对多层卷积神经网络的全自动链式攻击流程。

#### Independent Recovery of the First Convolutional Layer Weights
```bash
python Attack_Layer1_PSP.py
```
This script recovers the weights of the first layer using the searched PSP, and displays the extraction precision, total recovery time, and the number of model queries.

OR

```bash
python Attack_Layer1_RPCP.py
```
This script directly recovers the weights using RPCP, and simultaneously displays experimental data such as extraction precision, recovery time, and the number of model queries.

### Independent Recovery of the Second Convolutional Layer Weights
```bash
Attack_Layer2_PSP.py
```
This script completes the recovery of the second convolutional layer using PSP and the weights of the first convolutional layer extracted in the previous step.

OR

```bash
Attack_Layer2_RPCP.py
```
This script implements the complete process of extracting and recovering the weights of the second layer via RPCP.

---
