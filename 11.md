# Algebraic Attack on Convolutional Neural1 Network with Max Pooling
> (1+1) SIMPLE CNN CRYPTANALYTIC EXTRACTION PROJECT

## Project Overview
This experiment achieves **the first successful recovery** of parameters for Convolutional Neural Networks (CNNs) with max-pooling layers. This project demonstrates the complete process of successfully recovering the weights of a two-layer (1+1) CNN model trained on a random dataset under the **black-box scenario**.

## Model Architecture
The model takes a 32×32 single-channel image as input, first applies average pooling for downsampling, followed by a convolution layer and max pooling. The extracted features are then flattened and passed through the fully connected layers to produce a 10-dimensional classification output.

Input: 1 × 32 × 32

→ AvgPool(4×4, stride=4)

→ Conv(1 → 1, 3×3, stride=1, no padding) + ReLU

→ MaxPool(2×2, stride=2)

→ Flatten

→ FC1(9 → 5) + ReLU

→ FC(5 → 10)

## Brief Description of Key Files
1. **common.py**:Provides basic configurations and model definitions, and stores model information for accuracy testing.
2. **extract_signature_cuda.py**: Extracts the signatures of the CNN's convolutional layer with GPU acceleration, processes the difference vectors collected from Pooling Switch Points (PSP) via Singular Value Decomposition (SVD), solves homogeneous linear equations, and extracts the model weights.
3. **reconstructCNN.py**: Contains modules for model parameter reconstruction and error analysis. It recovers the complete weight matrix of convolutional kernels using the extracted vectors and compares the precision with the ground truth values.
4. **recover_sign.py**: Adopts the ReLU-Pooling Critical Point (RPCP) method and leverages the characteristics of max-pooling layers to recover the signs of weights.
5. **find_witnesses.py**:Finds the critical points that meet the specified requirements.


## Explanation of this Codebase
This codebase bases its structure from Carlini et al's codebase that can be found under https://github.com/google-research/cryptanalytic-model-extraction.All convolutional and max-pooling specific components are implemented independently in this work.


## Installation

```bash
pip install torch numpy scipy jax jaxlib matplotlib networkx
```

## Workflow Pipeline

### STEP1:Generate the CNN Model

```bash
python createCNN_random.py
```
This command generates a CNN model trained on a random dataset (e.g., simple_cnn_random.pth). Run create_CNN.py to generate a CNN model trained on the MNIST dataset (e.g., simple_cnn.pth).

Meanwhile, import your newly generated model into common.py.

### STEP2:Directly Extract CNN Model Weights and Verify Precision

```bash
python AttackCNN.py
```
This command completes the full process including weight extraction, precision improvement, weight sign recovery and precision detection, and outputs the complete experimental data.

---
