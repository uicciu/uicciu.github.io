# Algebraic Attack on Convolutional Neural1 Network with Max Pooling
> (2+1) SIMPLE CNN CRYPTANALYTIC EXTRACTION PROJECT

## Project Overview
This project demonstrates the complete process of successfully recovering the weights of a two-layer (2+1) CNN model trained on MNIST dataset under the **black-box scenario**.

## Model Architecture
We consider a lightweight CNN for MNIST consisting of two convolutional layers with max-pooling, followed by one fully connected layers:

1×32×32

→ Conv(1→1, 5×5) + ReLU → MaxPool(2×2)

→ Conv(1→1, 5×5) + ReLU → MaxPool(2×2)

→ Flatten (5×5 = 25)

→ FC1(25→18) 

→ FC(18→10)

## Brief Description of Key Files
1. **common.py**:Provides basic configurations and model definitions, and stores model information for accuracy testing.
2. **extract_signature_cuda.py**: Extracts the signatures of the CNN's **two convolutional layers** with GPU acceleration, processes the difference vectors collected from Pooling Switch Points (PSP) via Singular Value Decomposition (SVD), solves homogeneous linear equations, and extracts the weights of the two convolutional layers.
3. **reconstructCNN.py**: Contains modules for model parameter reconstruction and error analysis. It recovers the complete weight matrix of convolutional kernels using the extracted vectors and compares the precision with the ground truth values.
4. **recover_sign.py**: Adopts the ReLU-Pooling Critical Point (RPCP) method and leverages the characteristics of max-pooling layers to recover the signs of weights.
5. **find_witnesses.py**:Finds the critical points that meet the specified requirements.
6. **AttackCNN_Function.py**:Contains functions for recovering the weights of the first convolutional layer.
7. **AttackCNN2_Function.py**:Contains functions for recovering the weights of the second convolutional layer.


## Explanation of this Codebase
This codebase bases its structure from Carlini et al's codebase that can be found under https://github.com/google-research/cryptanalytic-model-extraction.All convolutional and max-pooling specific components are implemented independently in this work.

## Installation

> pip install torch numpy scipy jax jaxlib matplotlib networkx

## Workflow Pipeline

### STEP1:Generate the CNN Model

```bash
python create_CNN.py
```
Modify the parameters to generate your own CNN model, or directly use the pre-generated model we provide (e.g., simple_cnn_2+1.pth).

Meanwhile, import your newly generated model into **common.py**.

### STEP2:Extract CNN Model Weights

#### One-Click Extraction of Weights for Two Convolutional Layers
```bash
python Attack_all.py
```
This script performs weight extraction using PSP and sign recovery using RPCP. It fully demonstrates the extraction process of the two CNN layers in black-box mode, along with the corresponding precision comparison and experimental data.

#### Independent Recovery of the First Convolutional Layer Weights
```bash
python Attack_Layer1_PSP.py
```
This script recovers the weights of the first layer using the searched PSP, and displays the extraction precision, total recovery time, and the number of model queries.

OR

```bash
python Attack_Layer1_RPCP.py
```
This script directly recovers the weights using RPCP, and simultaneously displays experimental data such as extraction precision, recovery time, and the number of model queries.

### Independent Recovery of the Second Convolutional Layer Weights
```bash
Attack_Layer2_PSP.py
```
This script completes the recovery of the second convolutional layer using PSP and the weights of the first convolutional layer extracted in the previous step.

OR

```bash
Attack_Layer2_RPCP.py
```
This script implements the complete process of extracting and recovering the weights of the second layer via RPCP.

---

